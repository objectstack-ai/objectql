# ObjectQL 开发路线图 - v0.9.0 内核升级后

**日期**: 2026年2月2日  
**内核版本**: @objectstack/* v0.9.0  
**ObjectQL 版本**: v4.0.5  
**状态**: 📋 规划阶段

---

## 概述

本文档概述了 ObjectQL 成功升级到 @objectstack 内核 v0.9.0 后的下一阶段开发计划。该路线图围绕 @objectstack/spec v0.9.0 中定义的新协议架构组织，该架构在五个协议命名空间中引入了增强的模块化和新功能。

## 1. 内核升级状态 ✅

### 已完成的更新
- **@objectstack/core**: 0.8.2 → 0.9.0 ✅
- **@objectstack/runtime**: 0.8.2 → 0.9.0 ✅
- **@objectstack/spec**: 0.8.2 → 0.9.0 ✅
- **@objectstack/objectql**: 0.8.2 → 0.9.0 ✅
- **@objectstack/cli**: 0.8.2 → 0.9.0 ✅
- **@objectstack/plugin-hono-server**: 0.8.2 → 0.9.0 ✅

### 兼容性评估
- ✅ **100% 向后兼容**: 所有 160 个核心测试通过
- ✅ **无破坏性变更**: 现有代码无需修改即可工作
- ✅ **构建状态**: 30/31 包编译成功
- ✅ **零迁移需求**: 直接替换即可

---

## 2. 协议架构演进

@objectstack/spec@0.9.0 引入了一个五命名空间架构，映射到 ObjectStack 的三层系统：

### 2.1 数据协议 (`@objectstack/spec/data`) - ObjectQL 层
**当前状态**: 🟢 完全实现

**范围**:
- 对象和字段定义
- 查询 AST（高级查询语言）
- 驱动器接口
- 验证和权限
- 共享和流程

**下一步**:
- [ ] 增强查询 AST 以利用新的规范功能
- [ ] 实现规范中的高级验证规则
- [ ] 添加对新字段类型的支持（如果有）

### 2.2 AI 协议 (`@objectstack/spec/ai`) - 新增 🆕
**当前状态**: 🟡 部分实现

**范围**:
- Agent 编排
- RAG（检索增强生成）
- 模型注册表
- 提示词管理

**差距分析**:
- ❌ RAG 能力尚未集成
- ❌ 模型注册表未实现
- ❌ 提示词管理系统缺失

**优先任务**:
1. **[中优先级] 实现 RAG 系统**
   - 创建 @objectql/plugin-rag 包
   - 向量数据库集成（Redis/Pinecone/Qdrant）
   - 语义搜索能力
   
3. **[低优先级] 模型注册表**
   - 集中式模型配置
   - 多提供商支持（OpenAI、Anthropic、本地模型）
   - 成本跟踪和速率限制

### 2.3 UI 协议 (`@objectstack/spec/ui`) - 新增 🆕
**当前状态**: 🔴 未实现

**范围**:
- 应用、页面、视图（网格/看板/日历）
- 仪表板和小部件
- 报告生成器
- 操作触发器

**差距分析**:
- ❌ ObjectQL monorepo 中没有 UI 层实现
- ✅ 协议规范存在且定义良好
- 🎯 机会：创建 @objectql/ui 或独立的 ObjectUI 包

**优先任务**:
1. **[未来] UI 协议基础**
   - 决策：在 ObjectQL 中实现还是独立仓库？
   - 创建元数据驱动的 UI 渲染器
   - React/Vue 组件库
   
2. **[未来] 管理界面**
   - 自动生成的 CRUD 界面
   - 基于对象元数据的动态表单
   - 带过滤/排序的列表视图

### 2.4 系统协议 (`@objectstack/spec/system`) - ObjectOS 层
**当前状态**: 🟢 部分实现

**范围**:
- 清单和配置
- 身份和认证
- RBAC（基于角色的访问控制）
- 多租户
- 事件总线
- 插件生命周期

**差距分析**:
- ✅ 插件生命周期完全支持
- ✅ 事件钩子已实现
- 🟡 RBAC 存在但需要与新规范对齐
- ❌ 多租户未实现
- ❌ 身份管理基础

**优先任务**:
1. **[高优先级] 增强 RBAC**
   - 更新 @objectql/plugin-security 以使用 `@objectstack/spec/system/role`
   - 实现字段级权限
   - 行级安全（RLS）
   
2. **[中优先级] 多租户**
   - 租户隔离策略
   - 数据分区
   - 租户感知驱动器

### 2.5 API 协议 (`@objectstack/spec/api`) - 新增 🆕
**当前状态**: 🟢 已实现（通过协议）

**范围**:
- 契约和 DTO
- 端点和网关
- 发现（元数据 API）
- 实时（WebSocket/SSE）

**差距分析**:
- ✅ GraphQL、OData、REST、JSON-RPC 协议已实现
- ✅ 通过内省进行元数据发现
- 🟡 实时支持部分（仅 GraphQL 订阅）
- ❌ 无统一网关/路由器

**优先任务**:
1. **[中优先级] 统一 API 网关**
   - 多协议路由器
   - 请求/响应转换
   - 速率限制和缓存
   
2. **[低优先级] 实时增强**
   - 服务器发送事件（SSE）支持
   - 变更数据捕获（CDC）流
   - 跨协议事件广播

---

## 3. 增强的内核功能（v0.9.0）

### 3.1 解锁的新功能

v0.9.0 内核引入了几个企业级功能：

#### ✅ 增强的日志系统
- **Pino 集成**: 高性能结构化日志
- **自动脱敏**: 敏感数据保护
- **环境检测**: Node.js vs 浏览器

**行动项**:
- [ ] 更新所有包以利用新的日志系统
- [ ] 按环境配置日志级别
- [ ] 实现日志聚合（可选）

#### ✅ 高级插件管理
- **异步加载**: 非阻塞插件初始化
- **版本兼容性**: 语义版本检查
- **插件签名**: 安全验证（可扩展）
- **健康检查**: 运行时插件监控

**行动项**:
- [ ] 为所有插件添加版本约束
- [ ] 实现健康检查端点
- [ ] 创建插件注册表仪表板（可选）

#### ✅ 服务生命周期管理
- **工厂模式**: 单例、瞬态、作用域服务
- **循环依赖检测**: 自动验证
- **延迟加载**: 按需服务实例化

**行动项**:
- [ ] 重构插件以使用服务工厂
- [ ] 记录服务生命周期模式
- [ ] 添加依赖关系图可视化（可选）

#### ✅ 配置验证
- **基于 Zod 的模式**: 运行时验证
- **类型安全**: 从 Zod 推断 TypeScript

**行动项**:
- [ ] 为所有插件配置添加 Zod 模式
- [ ] 使用验证的配置示例更新文档

---

## 4. 优先开发阶段

### 第 1 阶段：核心对齐（2026 年第一季度）🎯
**目标**: 将现有组件与新规范对齐

**任务**:
1. ✅ 将内核依赖项更新到 v0.9.0（已完成）
2. [ ] 更新 @objectql/plugin-security 以使用 `@objectstack/spec/system/role`
3. [ ] 为所有插件配置添加 Zod 验证模式
4. [ ] 在所有包中实现结构化日志
5. [ ] 更新文档以反映新架构

**交付成果**:
- [ ] 更新的插件包（ai-agent、security）
- [ ] v0.9.0 功能的迁移指南
- [ ] 架构决策记录（ADR）

**预计时间**: 2-3 周

---

### 第 2 阶段：AI 能力增强（2026 年第一季度至第二季度）🤖
**目标**: 构建生产就绪的 AI 功能

**任务**:
1. [ ] 实现 RAG 系统（@objectql/plugin-rag）
   - 向量数据库集成
   - 文档分块和嵌入
   - 语义搜索 API
   
2. [ ] 增强 AI Agent 编排
   - 多步骤工作流
   - 工具/函数调用
   - Agent 协作
   
3. [ ] 创建模型注册表
   - 多提供商支持
   - 成本跟踪
   - 速率限制和配额
   
4. [ ] 提示词管理系统
   - 模板库
   - 提示词版本控制
   - A/B 测试能力

**交付成果**:
- [ ] @objectql/plugin-rag 包
- [ ] @objectql/plugin-model-registry（可选）
- [ ] RAG 集成示例
- [ ] AI 功能文档

**预计时间**: 6-8 周

---

### 第 3 阶段：多租户和高级安全（2026 年第二季度）🔒
**目标**: 企业级隔离和安全

**任务**:
1. [ ] 多租户架构
   - 租户隔离策略（架构/数据库/行级）
   - 租户感知驱动器
   - 租户配置管理
   
2. [ ] 增强的 RBAC
   - 字段级权限
   - 行级安全（RLS）
   - 动态权限评估
   
3. [ ] 高级身份管理
   - SSO/SAML 集成
   - OAuth2/OIDC 提供商
   - API 密钥管理
   
4. [ ] 审计跟踪增强
   - 全面的审计日志
   - 变更跟踪
   - 合规性报告

**交付成果**:
- [ ] 多租户驱动器包装器
- [ ] 增强的安全插件
- [ ] 身份管理系统
- [ ] 审计跟踪仪表板
- [ ] 安全最佳实践指南

**预计时间**: 6-8 周

---

### 第 4 阶段：UI 协议实现（2026 年第二季度至第三季度）🎨
**目标**: 元数据驱动的 UI 生成

**任务**:
1. [ ] 评估实现策略
   - 独立包 vs ObjectQL 集成
   - 技术栈（React/Vue/Svelte）
   - 渲染策略（SSR/CSR/Islands）
   
2. [ ] UI 元数据引擎
   - 从 @objectstack/spec 解析 UI 协议
   - 组件注册表
   - 主题系统
   
3. [ ] 核心组件
   - 自动生成的表单
   - 带过滤/排序的数据网格
   - 看板/日历视图
   - 仪表板小部件
   
4. [ ] 管理界面
   - 对象浏览器
   - 架构编辑器（低代码）
   - 用户管理
   - 设置和配置

**交付成果**:
- [ ] @objectql/ui 或独立的 ObjectUI 包
- [ ] 组件库
- [ ] 管理仪表板
- [ ] UI 构建器（可选）
- [ ] UI 协议文档

**预计时间**: 10-12 周

**决策点**: 这应该在 ObjectQL monorepo 中还是独立？

---

### 第 5 阶段：API 网关和实时（2026 年第三季度）🌐
**目标**: 具有实时功能的统一 API 层

**任务**:
1. [ ] 统一 API 网关
   - 多协议路由
   - 请求转换
   - 响应缓存
   - 速率限制
   
2. [ ] 实时系统
   - 服务器发送事件（SSE）
   - WebSocket 广播
   - 变更数据捕获（CDC）
   - 事件溯源
   
3. [ ] API 管理
   - API 版本控制
   - 文档生成（OpenAPI/GraphQL SDL）
   - API 分析
   - 开发者门户

**交付成果**:
- [ ] @objectql/gateway 包
- [ ] 实时事件系统
- [ ] API 管理仪表板
- [ ] 开发者文档

**预计时间**: 8-10 周

---

## 5. 协议合规矩阵

| 协议命名空间 | 规范版本 | 实现状态 | 合规性 | 优先级 |
|-------------|---------|---------|--------|--------|
| **数据** | 0.9.0 | ✅ 完成 | 95% | 维护 |
| **AI** | 0.9.0 | 🟡 部分 | 40% | 高 |
| **UI** | 0.9.0 | 🔴 未开始 | 0% | 中 |
| **系统** | 0.9.0 | 🟡 部分 | 60% | 高 |
| **API** | 0.9.0 | 🟢 已实现 | 85% | 中 |

**目标**: 到 2026 年第三季度在所有命名空间中实现 90%+ 的合规性

---

## 6. 技术债务和改进

### 6.1 代码质量
- [ ] 为所有配置添加 Zod 模式
- [ ] 实现全面的错误处理
- [ ] 为所有协议添加集成测试
- [ ] 提高 TypeScript 严格模式覆盖率

### 6.2 性能
- [ ] 查询优化（缓存、批处理）
- [ ] 插件的延迟加载
- [ ] 连接池
- [ ] Redis 缓存层

### 6.3 文档
- [ ] 更新所有 README 文件
- [ ] 创建迁移指南
- [ ] 添加架构图
- [ ] 视频教程（可选）

### 6.4 测试
- [ ] 将测试覆盖率提高到 90%+
- [ ] 为协议添加 E2E 测试
- [ ] 性能基准测试
- [ ] 安全测试（渗透测试）

---

## 7. 破坏性变更策略

### 版本控制策略
遵循语义版本控制（SemVer）：
- **主要版本**: 破坏性变更（4.x → 5.x）
- **次要版本**: 新功能，向后兼容（4.0 → 4.1）
- **补丁版本**: 错误修复（4.0.5 → 4.0.6）

### 下一个主要版本（v5.0.0）
**暂定发布**: 2026 年第三季度至第四季度

**计划的破坏性变更**:
1. 完全迁移到 @objectstack/spec v1.0.0（发布时）
2. 删除已弃用的 API
3. 要求 Node.js 20+（LTS）
4. 多租户作为默认

---

## 8. 成功指标

### 技术 KPI
- [ ] 协议合规性：所有命名空间 90%+
- [ ] 测试覆盖率：90%+
- [ ] 构建时间：< 2 分钟
- [ ] 零关键漏洞
- [ ] 100% TypeScript 严格模式

### 产品 KPI
- [ ] 5+ 生产部署
- [ ] 100+ GitHub 星标
- [ ] 10+ 社区贡献者
- [ ] 50+ 示例应用程序
- [ ] 完整的文档覆盖

---

## 9. 社区和生态系统

### 开源参与
- [ ] 创建贡献指南
- [ ] 设置 GitHub 讨论
- [ ] 每月社区电话会议
- [ ] Hacktoberfest 参与
- [ ] 会议演讲

### 生态系统增长
- [ ] 插件市场
- [ ] 模板库
- [ ] 集成合作伙伴（Auth0、Stripe 等）
- [ ] 托管提供商（Vercel、Railway、Fly.io）

---

## 10. 风险评估

### 高风险项
1. **UI 协议复杂性**: 需要大量工作，可能延迟路线图
   - **缓解**: 考虑社区驱动方法或第三方 UI
   
2. **多租户**: 复杂的架构变更
   - **缓解**: 分阶段推出，广泛测试
   
3. **破坏性变更**: 可能影响早期采用者
   - **缓解**: 长期弃用期，迁移工具

### 中风险项
1. **AI 功能稳定性**: RAG 系统可能不可预测
   - **缓解**: 广泛测试，回退机制
   
2. **大规模性能**: 未知限制
   - **缓解**: 负载测试，基准测试

---

## 11. 下一步行动（立即）

### 第 1-2 周
- [x] ✅ 将内核更新到 v0.9.0
- [ ] 为 UI 实现创建 ADR（架构决策记录）
- [ ] 为插件配置设计 Zod 模式
- [ ] 计划 AI 插件重构

### 第 3-4 周
- [ ] 在各个包中实现结构化日志
- [ ] 使用增强的 RBAC 更新 plugin-security
- [ ] 编写 v0.9.0 的迁移指南

### 第 2 个月
- [ ] 开始 RAG 系统实现
- [ ] 创建多租户设计文档
- [ ] 原型 UI 元数据引擎

---

## 12. 结论

升级到 @objectstack v0.9.0 代表了一个重要的里程碑，在保持完全向后兼容性的同时解锁了新功能。路线图侧重于：

1. **短期**: 将现有组件与新规范对齐
2. **中期**: 构建 AI 和安全功能
3. **长期**: UI 协议和 API 网关

**下次审查**: 2026 年第一季度末（2026 年 3 月 31 日）

**状态更新**: 每两周通过 GitHub 讨论

---

**文档所有者**: ObjectQL 核心团队  
**最后更新**: 2026 年 2 月 2 日  
**版本**: 1.0
