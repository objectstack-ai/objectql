# File: finance_payment.object.yml
# Object name is inferred from filename as 'finance_payment'
label: Payment
description: Payment transaction record
icon: money-dollar-circle-line

ai_context:
  intent: "Track customer payments and payment processing"
  domain: financial_management
  aliases: [payment, transaction, remittance]
  common_queries:
    - "Show payments by date"
    - "Find pending payments"
    - "List payments by method and status"

fields:
  payment_number:
    type: text
    required: true
    label: Payment Number
    unique: true
    index: true
  
  invoice:
    type: lookup
    reference_to: finance_invoice
    label: Related Invoice
    index: true
    ai_context:
      intent: "Invoice this payment applies to"
      semantic_type: association
  
  account:
    type: lookup
    reference_to: crm_account
    label: Customer Account
    required: true
    index: true
    ai_context:
      intent: "Customer making the payment"
      semantic_type: association
  
  payment_date:
    type: date
    required: true
    label: Payment Date
    index: true
  
  amount:
    type: currency
    required: true
    label: Payment Amount
  
  payment_method:
    type: select
    options:
      - label: Bank Transfer
        value: bank_transfer
      - label: Credit Card
        value: credit_card
      - label: Debit Card
        value: debit_card
      - label: Check
        value: check
      - label: Cash
        value: cash
      - label: PayPal
        value: paypal
      - label: Other
        value: other
    required: true
    index: true
    ai_context:
      intent: "Payment method for processing and reconciliation"
      selection_guidance: "Bank transfer for large amounts; Card for smaller transactions"
  
  currency:
    type: select
    options:
      - label: USD
        value: USD
      - label: EUR
        value: EUR
      - label: GBP
        value: GBP
      - label: CNY
        value: CNY
      - label: JPY
        value: JPY
    defaultValue: USD
    ai_context:
      intent: "Payment currency for foreign exchange handling"
  
  reference_number:
    type: text
    label: Reference/Transaction Number
    index: true
  
  status:
    type: select
    options:
      - label: Pending
        value: pending
      - label: Completed
        value: completed
      - label: Failed
        value: failed
      - label: Refunded
        value: refunded
    defaultValue: pending
    required: true
    index: true
    ai_context:
      intent: "Current processing state of payment"
      is_state_machine: true
      transitions:
        pending: [completed, failed]
        completed: [refunded]
        failed: [pending]
        refunded: []
  
  processed_by:
    type: lookup
    reference_to: user
    label: Processed By
    ai_context:
      intent: "User who processed this payment"
      semantic_type: association
  
  notes:
    type: textarea
    label: Notes

indexes:
  # For invoice payment lookup
  invoice_status_idx:
    fields: [invoice, status]
  
  # For account payment history
  account_date_idx:
    fields: [account, payment_date]
  
  # For payment method analysis
  method_status_idx:
    fields: [payment_method, status]
