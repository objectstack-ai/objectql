# File: finance_invoice.object.yml
# Object name is inferred from filename as 'finance_invoice'
label: Invoice
description: Customer invoice
icon: file-text-line

ai_context:
  intent: "Manage customer invoices and payment tracking"
  domain: financial_management
  aliases: [invoice, bill, statement]
  common_queries:
    - "Show unpaid invoices"
    - "Find overdue invoices by customer"
    - "List invoices by status and due date"

fields:
  invoice_number:
    type: text
    required: true
    label: Invoice Number
    unique: true
    index: true
  
  account:
    type: lookup
    reference_to: crm_account
    label: Customer Account
    required: true
    index: true
    ai_context:
      intent: "Customer being invoiced"
      semantic_type: association
  
  invoice_date:
    type: date
    required: true
    label: Invoice Date
    index: true
  
  due_date:
    type: date
    required: true
    label: Due Date
    index: true
  
  subtotal:
    type: currency
    required: true
    label: Subtotal
  
  tax_amount:
    type: currency
    label: Tax Amount
    defaultValue: 0
  
  discount_amount:
    type: currency
    label: Discount Amount
    defaultValue: 0
  
  total_amount:
    type: currency
    required: true
    label: Total Amount
  
  paid_amount:
    type: currency
    label: Paid Amount
    defaultValue: 0
  
  balance:
    type: currency
    label: Balance Due
  
  status:
    type: select
    options:
      - label: Draft
        value: draft
      - label: Sent
        value: sent
      - label: Partially Paid
        value: partial_paid
      - label: Paid
        value: paid
      - label: Overdue
        value: overdue
      - label: Cancelled
        value: cancelled
    defaultValue: draft
    required: true
    index: true
    ai_context:
      intent: "Current payment and delivery status"
      is_state_machine: true
      transitions:
        draft: [sent, cancelled]
        sent: [partial_paid, paid, overdue, cancelled]
        partial_paid: [paid, overdue]
        paid: []
        overdue: [partial_paid, paid]
        cancelled: []
  
  payment_terms:
    type: select
    options:
      - label: Net 15
        value: net_15
      - label: Net 30
        value: net_30
      - label: Net 60
        value: net_60
      - label: Net 90
        value: net_90
      - label: Due on Receipt
        value: due_on_receipt
    label: Payment Terms
    ai_context:
      intent: "Payment due date terms"
      selection_guidance: "Net 30 is standard; adjust based on customer agreement"
  
  currency:
    type: select
    options:
      - label: USD
        value: USD
      - label: EUR
        value: EUR
      - label: GBP
        value: GBP
      - label: CNY
        value: CNY
      - label: JPY
        value: JPY
    defaultValue: USD
    index: true
    ai_context:
      intent: "Invoice currency for international transactions"
  
  billing_address:
    type: textarea
    label: Billing Address
  
  notes:
    type: textarea
    label: Notes
  
  internal_notes:
    type: textarea
    label: Internal Notes

indexes:
  # For account invoice history
  account_date_idx:
    fields: [account, invoice_date]
  
  # For payment tracking
  status_due_date_idx:
    fields: [status, due_date]
  
  # For aging reports
  due_date_status_idx:
    fields: [due_date, status]

actions:
  send:
    type: record
    label: Send Invoice
    icon: mail-send-line
    confirm_text: "Send this invoice to customer?"
  
  mark_paid:
    type: record
    label: Mark as Paid
    icon: checkbox-circle-line
    params:
      payment_date:
        type: date
        label: Payment Date
        required: true
      payment_method:
        type: select
        label: Payment Method
        options:
          - bank_transfer
          - credit_card
          - check
          - cash
