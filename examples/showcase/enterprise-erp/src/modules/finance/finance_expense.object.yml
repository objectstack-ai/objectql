# File: finance_expense.object.yml
# Object name is inferred from filename as 'finance_expense'
label: Expense
description: Company expense record
icon: wallet-line

ai_context:
  intent: "Track and manage employee expense claims and reimbursements"
  domain: financial_management
  aliases: [expense, expense claim, reimbursement]
  common_queries:
    - "Show pending expense approvals"
    - "Find expenses by employee"
    - "List expenses by category and date"

fields:
  expense_number:
    type: text
    required: true
    label: Expense Number
    unique: true
    index: true
  
  employee:
    type: lookup
    reference_to: hr_employee
    label: Employee
    required: true
    index: true
    ai_context:
      intent: "Employee who incurred this expense"
      semantic_type: association
  
  expense_date:
    type: date
    required: true
    label: Expense Date
    index: true
  
  category:
    type: select
    options:
      - label: Travel
        value: travel
      - label: Meals
        value: meals
      - label: Office Supplies
        value: office_supplies
      - label: Software
        value: software
      - label: Marketing
        value: marketing
      - label: Utilities
        value: utilities
      - label: Rent
        value: rent
      - label: Training
        value: training
      - label: Other
        value: other
    required: true
    index: true
    ai_context:
      intent: "Expense category for budget tracking"
      selection_guidance: "Choose category matching budget allocations"
  
  amount:
    type: currency
    required: true
    label: Amount
  
  currency:
    type: select
    options:
      - label: USD
        value: USD
      - label: EUR
        value: EUR
      - label: GBP
        value: GBP
      - label: CNY
        value: CNY
      - label: JPY
        value: JPY
    defaultValue: USD
    ai_context:
      intent: "Currency for international expense handling"
  
  merchant:
    type: text
    label: Merchant/Vendor
  
  description:
    type: textarea
    required: true
    label: Description
  
  receipt_url:
    type: file
    label: Receipt Attachment
  
  status:
    type: select
    options:
      - label: Draft
        value: draft
      - label: Submitted
        value: submitted
      - label: Approved
        value: approved
      - label: Rejected
        value: rejected
      - label: Reimbursed
        value: reimbursed
    defaultValue: draft
    required: true
    index: true
    ai_context:
      intent: "Current approval and payment state"
      is_state_machine: true
      transitions:
        draft: [submitted]
        submitted: [approved, rejected]
        approved: [reimbursed]
        rejected: [draft]
        reimbursed: []
  
  approved_by:
    type: lookup
    reference_to: user
    label: Approved By
    ai_context:
      intent: "Manager who approved this expense"
      semantic_type: association
  
  approved_at:
    type: datetime
    label: Approval Time
  
  reimbursed_at:
    type: date
    label: Reimbursement Date
  
  department:
    type: lookup
    reference_to: hr_department
    label: Department
    index: true
    ai_context:
      intent: "Department to charge this expense to"
      semantic_type: association
  
  project:
    type: lookup
    reference_to: project_project
    label: Related Project
    ai_context:
      intent: "Project to charge this expense to"
      semantic_type: association

indexes:
  # For employee expense lookup
  employee_status_idx:
    fields: [employee, status]
  
  # For category analysis
  category_date_idx:
    fields: [category, expense_date]
  
  # For approval workflow
  status_date_idx:
    fields: [status, expense_date]
  
  # For department budget tracking
  department_category_idx:
    fields: [department, category]

actions:
  submit:
    type: record
    label: Submit for Approval
    icon: send-plane-line
  
  approve:
    type: record
    label: Approve Expense
    icon: checkbox-circle-line
  
  reject:
    type: record
    label: Reject Expense
    icon: close-circle-line
    params:
      reason:
        type: textarea
        label: Rejection Reason
        required: true
  
  reimburse:
    type: record
    label: Mark as Reimbursed
    icon: money-dollar-circle-line
    params:
      reimbursement_date:
        type: date
        label: Reimbursement Date
        required: true
