# File: project_timesheet_entry.object.yml
# Object name is inferred from filename as 'project_timesheet_entry'
label: Timesheet Entry
description: Time entry for project tasks
icon: time-line

ai_context:
  intent: "Track time spent on project tasks for billing and productivity"
  domain: project_management
  aliases: [time entry, timesheet, time log]
  common_queries:
    - "Show time entries by project"
    - "Find billable hours by employee"
    - "List time entries for approval"

fields:
  employee:
    type: lookup
    reference_to: hr_employee
    label: Employee
    required: true
    index: true
    ai_context:
      intent: "Employee who performed the work"
      semantic_type: association
  
  project:
    type: lookup
    reference_to: project_project
    label: Project
    required: true
    index: true
    ai_context:
      intent: "Project this time is charged to"
      semantic_type: hierarchy
  
  task:
    type: lookup
    reference_to: project_task
    label: Task
    index: true
    ai_context:
      intent: "Specific task this time is charged to"
      semantic_type: association
  
  work_date:
    type: date
    required: true
    label: Work Date
    index: true
  
  hours:
    type: number
    required: true
    label: Hours Worked
    scale: 2
    min: 0
    max: 24
  
  description:
    type: textarea
    label: Work Description
  
  billable:
    type: boolean
    defaultValue: true
    label: Billable
    index: true
  
  status:
    type: select
    options:
      - label: Draft
        value: draft
      - label: Submitted
        value: submitted
      - label: Approved
        value: approved
      - label: Rejected
        value: rejected
    defaultValue: draft
    index: true
    ai_context:
      intent: "Approval workflow state"
      is_state_machine: true
      transitions:
        draft: [submitted]
        submitted: [approved, rejected]
        approved: []
        rejected: [draft]
  
  approved_by:
    type: lookup
    reference_to: user
    label: Approved By
    ai_context:
      intent: "Manager who approved this time entry"
      semantic_type: association
  
  approved_at:
    type: datetime
    label: Approval Time

indexes:
  # For employee timesheet
  employee_date_idx:
    fields: [employee, work_date]
  
  # For project time tracking
  project_date_idx:
    fields: [project, work_date]
  
  # For task time tracking
  task_employee_idx:
    fields: [task, employee]
  
  # For billing
  billable_status_idx:
    fields: [billable, status]

actions:
  submit:
    type: record
    label: Submit for Approval
    icon: send-plane-line
  
  approve:
    type: record
    label: Approve Entry
    icon: checkbox-circle-line
