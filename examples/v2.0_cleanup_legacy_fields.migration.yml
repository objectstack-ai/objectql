# Example Migration File: Remove Deprecated Fields
# File: v2.0_cleanup_legacy_fields.migration.yml
#
# This migration demonstrates how to safely remove deprecated fields
# from objects with proper archival strategies.

version: 2.0.0
name: Remove Legacy Fields
description: |
  Clean up deprecated fields that are no longer used in the application.
  This migration archives data before deletion for rollback capability.

author: dev-team
created_at: 2026-02-01T00:00:00Z

steps:
  # Step 1: Remove legacy_id from users
  - id: step_1
    name: Remove legacy_id from users
    description: Archive and remove the deprecated legacy_id field
    
    instruction:
      type: field_delete
      object_name: users
      field_name: legacy_id
      
      # Archive data before deletion (safe strategy)
      deletion_strategy: archive
      archive_location: backups/users_legacy_id
      
      description: Remove deprecated legacy_id field
      reason: Field no longer needed after migration to new ID system
      timestamp: 2026-02-01T10:00:00Z
    
    reversible: true

  # Step 2: Remove old_status from projects
  - id: step_2
    name: Remove old_status from projects
    description: Soft-delete the deprecated status field
    
    instruction:
      type: field_delete
      object_name: projects
      field_name: old_status
      
      # Soft delete - mark as deleted but keep data
      deletion_strategy: soft
      
      description: Remove deprecated status field
      reason: Replaced by new status state machine
      timestamp: 2026-02-01T10:30:00Z
    
    reversible: true
    # This step depends on step_1 completing first
    depends_on:
      - step_1

  # Step 3: Drop temporary_notes field permanently
  - id: step_3
    name: Drop temporary_notes from tasks
    description: Permanently remove temporary notes field
    
    instruction:
      type: field_delete
      object_name: tasks
      field_name: temporary_notes
      
      # Permanent deletion (irreversible)
      deletion_strategy: drop
      
      description: Remove temporary notes field
      reason: Temporary data no longer needed
      timestamp: 2026-02-01T11:00:00Z
    
    # Cannot be rolled back (drop is permanent)
    reversible: false
    depends_on:
      - step_2

reversible: false  # Overall migration not reversible due to step_3
tags:
  - cleanup
  - deprecated
  - breaking-change

# ========================================
# Field Deletion Strategies
# ========================================

# deletion_strategy: archive (Recommended)
#   - Safest option for production
#   - Backs up data before deletion
#   - Allows rollback if needed
#   - Requires archive_location to be specified

# deletion_strategy: soft
#   - Marks field as deleted
#   - Keeps data in database
#   - Useful for gradual rollout
#   - Can be reversed easily

# deletion_strategy: drop
#   - Permanent deletion
#   - Cannot be rolled back
#   - Use only when certain
